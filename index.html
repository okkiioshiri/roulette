<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>stylish roulette</title>
<style>
    /* =========================================
       テーマ・色設定 (Variables)
       ========================================= */
    :root {
        --bg-color: #f9f9f9;
        --text-color: #333;
        --card-bg: #fff;
        --border-color: #ccc;
        --highlight-color: #ddd;
        --accent-color: #007aff;
        --danger-color: #ff3b30;
        --shadow-color: rgba(0, 0, 0, 0.15);
        --tooltip-bg: rgba(51, 51, 51, 0.6);
    }
    body.dark {
        --bg-color: #1e1e1e;
        --text-color: #f9f9f9;
        --card-bg: #2c2c2c;
        --border-color: #555;
        --highlight-color: #444;
        --accent-color: #4da3ff;
        --danger-color: #ff453a;
        --shadow-color: rgba(0, 0, 0, 0.5);
        --tooltip-bg: rgba(249, 249, 249, 0.6);
    }

    /* =========================================
       基本レイアウト
       ========================================= */
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        transition: background 0.3s, color 0.3s;
    }
    .container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        width: 100%;
        max-width: 1200px;
        gap: 10px;
    }
    .main {
        text-align: center;
        margin: 0 5px;
        position: relative;
        flex: 1 1 auto;
    }

    /* =========================================
       サイドバー (List & History)
       ========================================= */
    #itemList, #history {
        width: 260px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 10px;
        font-size: 16px;
        margin: 10px 0;
        display: flex;
        flex-direction: column;
        max-height: calc(100vh - 150px);
        overflow-y: auto;
        overflow-x: hidden;
        transition: background 0.3s, border-color 0.3s;
        box-shadow: 0 2px 8px var(--shadow-color);
    }
    #list, #historyList {
        list-style: none;
        padding: 0;
        margin: 0;
        width: 100%;
    }
    #itemList::-webkit-scrollbar, #history::-webkit-scrollbar {
        width: 6px;
    }
    #itemList::-webkit-scrollbar-thumb, #history::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }
    #itemList h2, #history h2 {
        text-align: center;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--border-color);
        flex-shrink: 0;
    }
    #itemList li {
        padding: 6px 0;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        position: relative;
        cursor: grab;
    }
    #itemList li:active { cursor: grabbing; }
    #itemList li.dragging { opacity: 0.5; background: var(--highlight-color); }
    #itemList li.over { border-top: 2px solid var(--accent-color); }
    .item-text {
        flex: 1; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; pointer-events: none;
    }
    .highlight { background-color: var(--highlight-color); }
    .final-highlight { background-color: var(--highlight-color); font-weight: bold; }
    .inactive .item-text { color: #aaa; opacity: 0.6; }

    /* =========================================
       ルーレット本体
       ========================================= */
    #titleInput {
        font-size: 28px; font-weight: 500; text-align: center; border: none; background: transparent;
        color: var(--text-color); outline: none; width: calc(100% - 20px); margin: 0 auto 10px auto; display: block;
    }
    #selectedItem {
        font-size: 24px; font-weight: bold; margin: 20px 0; min-height: 30px;
    }
    .roulette-wrapper {
        position: relative; width: 400px; height: 400px; margin: 0 auto;
        border-radius: 50%; box-shadow: 0 10px 25px var(--shadow-color);
    }
    .roulette-wrapper::after {
        content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 40px; height: 40px; background: var(--card-bg); border: 4px solid var(--text-color);
        border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 10; pointer-events: none;
    }
    #roulette {
        width: 400px; height: 400px; transform: rotate(0deg); filter: drop-shadow(0 0 2px rgba(0,0,0,0.1));
    }
    .pointer {
        position: absolute; top: 50%; left: 100%; transform: translate(-55%, -50%) rotate(270deg);
        width: 0; height: 0; border-left: 18px solid transparent; border-right: 18px solid transparent;
        border-bottom: 24px solid var(--text-color); z-index: 20; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));
    }

    /* =========================================
       ボタン・コントロール
       ========================================= */
    .controls {
        display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 20px; width: 100%;
    }
    .input-group, .action-group, .file-group {
        display: flex; justify-content: center; gap: 10px; width: 100%; max-width: 480px;
    }
    .action-group + .action-group { margin-top: -5px; }
    .file-area {
        display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 480px; gap: 5px;
    }

    /* 高さ統一 */
    .input-group input[type="text"], 
    .file-input-wrapper, 
    button, 
    .custom-file-btn {
        height: 40px; 
        box-sizing: border-box;
    }

    .input-group input[type="text"] {
        flex: 1; padding: 0 10px; font-size: 16px;
        background: var(--card-bg); color: var(--text-color);
        border: 1px solid var(--border-color); border-radius: 4px; line-height: 38px;
    }

    /* Inputの隠し方を変更：display:noneではなく、透明にして配置 */
    #fileInput {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        opacity: 0; cursor: pointer; z-index: 10;
    }

    /* ボタン共通（80%透過） */
    button, .custom-file-btn {
        background: var(--text-color); color: var(--bg-color);
        border: none; border-radius: 6px; cursor: pointer;
        transition: background 0.3s, transform 0.2s, opacity 0.3s;
        position: relative; display: inline-flex; align-items: center; justify-content: center;
        font-size: 16px;
        opacity: 0.8; /* 透過設定 */
    }
    button:hover, .custom-file-btn:hover {
        opacity: 1;
    }
    button.clear-btn:hover { background-color: var(--danger-color); color: white; opacity: 1; }

    /* 横幅合わせ：追加ボタンと保存ボタン */
    .input-group button, 
    .file-group button.icon-only {
        width: 60px; /* 統一 */
        padding: 0; flex: 0 0 60px;
    }
    
    .action-group button { flex: 1; white-space: nowrap; padding: 0 10px; }

    /* ファイル入力ラッパー */
    .file-input-wrapper {
        flex: 1; position: relative; display: flex; align-items: center; justify-content: stretch;
    }
    .custom-file-btn {
        width: 100%; height: 100%;
        pointer-events: none; /* ラベル自体はクリックを透過させ、背面のInputに任せる、またはInputを前面に */
    }
    /* Inputが前面にあるので、ラベルのスタイルはInputの後ろに見えるように */
    /* 修正: Inputを前面に置くため、ラベルは見た目だけ担当 */
    
    .file-input-wrapper.dragover .custom-file-btn {
        background: var(--accent-color); color: white;
        box-shadow: 0 0 10px var(--accent-color); transform: scale(1.02); opacity: 1;
    }

    button.icon-only svg { width: 22px; height: 22px; fill: currentColor; }
    
    #fileNameDisplay {
        font-size: 13px; color: var(--text-color); opacity: 0.8;
        height: 18px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;
    }
    
    /* リスト内アイコン */
    .icon-btn {
        background: none; border: none; padding: 4px; font-size: 18px; color: var(--text-color);
        opacity: 0.8; height: auto;
    }
    .icon-btn:hover { color: var(--accent-color); opacity: 1; }
    .icon-btn.trash-btn:hover { color: var(--danger-color); }

    /* ツールチップ */
    [data-tooltip]::after {
        content: attr(data-tooltip); position: absolute;
        background: var(--tooltip-bg); color: var(--bg-color);
        padding: 5px 10px; font-size: 13px; border-radius: 6px;
        white-space: nowrap; opacity: 0; pointer-events: none;
        transition: opacity 0.2s ease, transform 0.2s ease;
        z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        backdrop-filter: blur(2px);
    }
    [data-tooltip]:hover::after { opacity: 1; }

    /* 位置指定 */
    .tooltip-btn.action::after, .tooltip-btn.list::after {
        top: 100%; left: 50%; transform: translateX(-50%) translateY(0); margin-top: 4px;
    }
    .tooltip-btn.action:hover::after, .tooltip-btn.list:hover::after { transform: translateX(-50%) translateY(4px); }

    .tooltip-right::after {
        top: 50%; left: 100%; transform: translateY(-50%) translateX(0); margin-left: 6px;
    }
    .tooltip-right:hover::after { transform: translateY(-50%) translateX(4px); }

    .tooltip-left::after {
        top: 50%; right: 100%; left: auto; transform: translateY(-50%) translateX(0); margin-right: 6px;
    }
    .tooltip-left:hover::after { transform: translateY(-50%) translateX(-4px); }

    /* ファイル入力のツールチップ（Wrapperにつける） */
    .file-input-wrapper[data-tooltip]::after {
        top: 50%; right: 100%; transform: translateY(-50%) translateX(0); margin-right: 6px;
    }
    .file-input-wrapper[data-tooltip]:hover::after { transform: translateY(-50%) translateX(-4px); }

    #darkModeBtn {
        position: absolute; top: 0; right: 0; background: none; border: none; cursor: pointer;
        width: 32px; height: 32px; opacity: 0.8;
    }
    #darkModeBtn:hover { opacity: 1; }
    #darkModeBtn svg { fill: var(--text-color); width: 100%; height: 100%; }
</style>
</head>
<body class="dark">

<div class="container">
    <div id="itemList">
        <h2>抽選リスト</h2>
        <ul id="list"></ul>
    </div>

    <div class="main">
        <input id="titleInput" type="text" value="ルーレット" />
        <button id="darkModeBtn" title="ダークモード切替">
            <svg viewBox="0 0 24 24"><path d="M12 3a9 9 0 0 0 0 18c4.97 0 9-4.03 9-9a9 9 0 0 0-9-9z"/></svg>
        </button>
        <div id="selectedItem"></div>
        <div class="roulette-wrapper">
            <div class="pointer"></div>
            <svg id="roulette" viewBox="0 0 400 400"></svg>
        </div>
        <div class="controls">
            <!-- 入力グループ -->
            <div class="input-group">
                <input type="text" id="itemInput" placeholder="項目を入力">
                <button onclick="addItem()">追加</button>
            </div>
            
            <!-- ファイル操作グループ -->
            <div class="file-area">
                <div class="file-group">
                    <div class="file-input-wrapper" id="dropZone" data-tooltip="CSV:復元 / TXT:追加">
                        <!-- Inputを透明にして前面に配置 -->
                        <input type="file" id="fileInput" accept=".csv,.txt">
                        <!-- 見た目用のボタン -->
                        <div class="custom-file-btn">ファイル選択</div>
                    </div>
                    
                    <button class="icon-only tooltip-btn tooltip-right" data-tooltip="現在の状態を保存" onclick="exportCSV()">
                        <svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
                    </button>
                </div>
                <div id="fileNameDisplay"></div>
            </div>

            <!-- アクションボタン群 -->
            <div class="action-group">
                <button class="tooltip-btn tooltip-left" data-tooltip="抽選結果を除外しない" onclick="startRoulette(false)">START</button>
                <button class="tooltip-btn tooltip-right" data-tooltip="抽選結果を除外する" onclick="startRoulette(true)">START & REMOVE</button>
            </div>
            <div class="action-group">
                <button class="tooltip-btn clear-btn tooltip-left" data-tooltip="項目リストを全削除" onclick="clearList()">CLEAR LIST</button>
                <button class="tooltip-btn clear-btn tooltip-right" data-tooltip="履歴と状態をリセット" onclick="clearHistory()">RESET</button>
            </div>
        </div>
    </div>

    <div id="history">
        <h2>抽選結果</h2>
        <ul id="historyList"></ul>
    </div>
</div>

<script>
let items = []; 
let idCounter = 0;
let angle = 0;
let lastWinnerId = null;
let dragSrcEl = null;

document.addEventListener('DOMContentLoaded', () => { renderRoulette(); });

document.getElementById('darkModeBtn').addEventListener('click', () => {
    document.body.classList.toggle('dark');
    renderRoulette();
});

document.getElementById('itemInput').addEventListener('keydown', e => { if (e.key === 'Enter') addItem(); });

function addItem(text = null) {
    const val = text || document.getElementById('itemInput').value.trim();
    if (!val) return;
    items.push({ id: idCounter++, text: val, active: true });
    if (!text) document.getElementById('itemInput').value = '';
    updateUI();
}

function loadAndProcessFile(file) {
    if (!file) return;
    document.getElementById('fileNameDisplay').textContent = file.name;
    const reader = new FileReader();
    reader.onload = ev => {
        const content = ev.target.result;
        if (content.startsWith('Type,Text,Active') || content.includes('Type,Text,Active')) {
            restoreFromCSV(content);
        } else {
            content.split(/\r?\n/).filter(line => line.trim()).forEach(line => {
                items.push({ id: idCounter++, text: line, active: true });
            });
            updateUI();
        }
    };
    reader.readAsText(file);
}

document.getElementById('fileInput').addEventListener('change', e => {
    loadAndProcessFile(e.target.files[0]);
    e.target.value = ''; 
});

const dropZone = document.getElementById('dropZone');

dropZone.addEventListener('dragover', e => {
    e.preventDefault(); e.stopPropagation();
    dropZone.classList.add('dragover');
});

dropZone.addEventListener('dragleave', e => {
    e.preventDefault(); e.stopPropagation();
    dropZone.classList.remove('dragover');
});

dropZone.addEventListener('drop', e => {
    e.preventDefault(); e.stopPropagation();
    dropZone.classList.remove('dragover');
    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
        loadAndProcessFile(e.dataTransfer.files[0]);
    }
});

function exportCSV() {
    const csvContent = [];
    csvContent.push('Type,Text,Active'); 
    items.forEach(i => {
        const text = `"${i.text.replace(/"/g, '""')}"`; 
        csvContent.push(`Item,${text},${i.active ? 1 : 0}`);
    });
    const historyLis = document.querySelectorAll('#historyList li');
    historyLis.forEach(li => {
        const text = `"${li.textContent.replace(/"/g, '""')}"`;
        csvContent.push(`History,${text},`);
    });
    if (lastWinnerId !== null) {
        const winnerItem = items.find(i => i.id === lastWinnerId);
        if (winnerItem) {
            const text = `"${winnerItem.text.replace(/"/g, '""')}"`;
            csvContent.push(`Winner,${text},`);
        }
    }
    const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csvContent.join('\n')], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `roulette_state_${new Date().toISOString().slice(0,19).replace(/[-T:]/g,'')}.csv`;
    a.click();
    URL.revokeObjectURL(url);
}

function restoreFromCSV(csvText) {
    items = [];
    idCounter = 0;
    lastWinnerId = null;
    document.getElementById('historyList').innerHTML = '';
    document.getElementById('selectedItem').textContent = '';
    const lines = csvText.split(/\r?\n/);
    lines.forEach(line => {
        if (!line.trim() || line.startsWith('Type,')) return; 
        const match = line.match(/^([^,]+),"(.*)",(.*)$/);
        if (match) {
            const type = match[1];
            const text = match[2].replace(/""/g, '"'); 
            const val = match[3];
            if (type === 'Item') {
                const isActive = parseInt(val) === 1;
                items.push({ id: idCounter++, text: text, active: isActive });
            } else if (type === 'History') {
                const ul = document.getElementById('historyList');
                const li = document.createElement('li');
                li.textContent = text;
                ul.appendChild(li);
            } else if (type === 'Winner') {
                setTimeout(() => {
                    const winnerItem = items.find(i => i.text === text);
                    if (winnerItem) {
                        lastWinnerId = winnerItem.id;
                        const itemNumber = items.indexOf(winnerItem) + 1;
                        document.getElementById('selectedItem').textContent = `${winnerItem.text}（番号: ${itemNumber}）`;
                        updateUI();
                    }
                }, 0);
            }
        }
    });
    updateUI();
}

function updateUI() {
    renderList();
    renderRoulette();
}

function clearList() {
    if (!items.length) return;
    if (confirm('項目リストを全て削除しますか？')) {
        items = [];
        lastWinnerId = null;
        updateUI();
    }
}

function handleDragStart(e) {
    if(e.target.tagName.toLowerCase() === 'button' || e.target.closest('button')) {
        e.preventDefault(); return;
    }
    this.classList.add('dragging');
    dragSrcEl = this;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', this.innerHTML);
}

function handleDragOver(e) {
    if (e.preventDefault) e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    this.classList.add('over');
    return false;
}

function handleDragLeave(e) {
    this.classList.remove('over');
}

function handleDrop(e) {
    if (e.stopPropagation) e.stopPropagation();
    const destEl = this;
    destEl.classList.remove('over');
    if (dragSrcEl !== destEl) {
        const srcIndex = parseInt(dragSrcEl.dataset.index);
        const destIndex = parseInt(destEl.dataset.index);
        const movedItem = items[srcIndex];
        items.splice(srcIndex, 1);
        items.splice(destIndex, 0, movedItem);
        updateUI();
    }
    return false;
}

function handleDragEnd(e) {
    this.classList.remove('dragging');
    document.querySelectorAll('#list li').forEach(li => {
        li.classList.remove('over');
        li.classList.remove('dragging');
    });
}

function renderList() {
    const ul = document.getElementById('list');
    ul.innerHTML = '';
    items.forEach((item, index) => {
        const li = document.createElement('li');
        li.dataset.index = index;
        li.setAttribute('draggable', 'true'); 
        
        li.addEventListener('dragstart', handleDragStart, false);
        li.addEventListener('dragover', handleDragOver, false);
        li.addEventListener('dragleave', handleDragLeave, false);
        li.addEventListener('drop', handleDrop, false);
        li.addEventListener('dragend', handleDragEnd, false);

        if (!item.active) li.classList.add('inactive');
        if (item.id === lastWinnerId) li.classList.add('final-highlight');

        const trashBtn = document.createElement('button');
        trashBtn.className = 'icon-btn tooltip-btn list trash-btn';
        trashBtn.setAttribute('data-tooltip', '削除');
        trashBtn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>';
        trashBtn.onclick = () => { items.splice(index, 1); updateUI(); };

        const span = document.createElement('span');
        span.className = 'item-text';
        span.textContent = `${index + 1}. ${item.text}`;

        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'icon-btn tooltip-btn list';
        toggleBtn.textContent = item.active ? '✕' : '♻';
        toggleBtn.setAttribute('data-tooltip', item.active ? '外す' : '戻す');
        toggleBtn.onclick = () => { item.active = !item.active; updateUI(); };

        li.append(trashBtn, span, toggleBtn);
        ul.appendChild(li);
    });
}

function renderRoulette() {
    const svg = document.getElementById('roulette');
    const isDark = document.body.classList.contains('dark');
    const startColor = isDark ? 200 : 250;
    const endColor = isDark ? 40 : 100;

    const activeList = items.filter(i => i.active);
    if (!activeList.length) {
        const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
        const radialGradient = document.createElementNS('http://www.w3.org/2000/svg', 'radialGradient');
        radialGradient.setAttribute('id', 'emptyGrad');
        radialGradient.innerHTML = `<stop offset="0%" stop-color="${isDark ? '#444' : '#fff'}" /><stop offset="100%" stop-color="${isDark ? '#111' : '#ddd'}" />`;
        defs.appendChild(radialGradient);
        svg.innerHTML = ''; svg.appendChild(defs);
        svg.innerHTML += `<circle cx="200" cy="200" r="190" fill="url(#emptyGrad)" stroke="${isDark ? '#333' : '#ccc'}" stroke-width="2"/>`;
        return;
    }

    svg.innerHTML = '';
    const segmentAngle = 360 / activeList.length;

    activeList.forEach((item, i) => {
        const ratio = activeList.length > 1 ? i / (activeList.length) : 0;
        const gray = Math.round(startColor - (startColor - endColor) * ratio);
        const color = `rgb(${gray},${gray},${gray})`;

        const startA = segmentAngle * i;
        const endA = startA + segmentAngle; 
        const x1 = 200 + 190 * Math.cos(Math.PI * startA / 180);
        const y1 = 200 + 190 * Math.sin(Math.PI * startA / 180);
        const x2 = 200 + 190 * Math.cos(Math.PI * endA / 180);
        const y2 = 200 + 190 * Math.sin(Math.PI * endA / 180);

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M200,200 L${x1},${y1} A190,190 0 ${segmentAngle > 180 ? 1 : 0} 1 ${x2},${y2} Z`);
        path.setAttribute('fill', color);
        path.setAttribute('stroke', color);
        path.setAttribute('stroke-width', '2');
        path.setAttribute('stroke-linejoin', 'round');
        svg.appendChild(path);
    });
    
    const borderCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    borderCircle.setAttribute('cx', '200'); borderCircle.setAttribute('cy', '200');
    borderCircle.setAttribute('r', '190'); borderCircle.setAttribute('fill', 'none');
    borderCircle.setAttribute('stroke', 'var(--text-color)');
    borderCircle.setAttribute('stroke-width', '4');
    borderCircle.setAttribute('opacity', '0.2');
    svg.appendChild(borderCircle);
}

function startRoulette(removeAfter) {
    const activeList = items.filter(i => i.active);
    if (!activeList.length) return alert('抽選対象がありません！');

    const randomIndex = Math.floor(Math.random() * activeList.length);
    const winner = activeList[randomIndex];
    
    const segmentAngle = 360 / activeList.length;
    const targetAngle = (11 * 360) + (segmentAngle * randomIndex) + (segmentAngle / 2);
    const duration = 3000;
    const startTime = performance.now();

    function animate(time) {
        const t = Math.min((time - startTime) / duration, 1);
        const progress = 1 - Math.pow(1 - t, 3);
        angle = targetAngle * progress;
        document.getElementById('roulette').style.transform = `rotate(${angle}deg)`;
        
        const currentIndex = Math.floor(((angle % 360 + 360) % 360) / segmentAngle) % activeList.length;
        const currentItem = activeList[currentIndex];
        
        document.querySelectorAll('#list li').forEach((li, idx) => {
            li.classList.toggle('highlight', items[idx].id === currentItem.id);
        });

        if (t < 1) {
            requestAnimationFrame(animate);
        } else {
            const originalIndex = items.findIndex(i => i.id === winner.id);
            document.getElementById('selectedItem').textContent = `${winner.text}（番号: ${originalIndex + 1}）`;
            addHistory(`${winner.text}（番号: ${originalIndex + 1}）`);
            lastWinnerId = winner.id;
            if (removeAfter) winner.active = false;
            updateUI();
        }
    }
    requestAnimationFrame(animate);
}

function addHistory(text) {
    const ul = document.getElementById('historyList');
    const li = document.createElement('li');
    li.textContent = `${text} (${new Date().toLocaleTimeString()})`;
    ul.insertBefore(li, ul.firstChild);
}

function clearHistory() {
    document.getElementById('historyList').innerHTML = '';
    items.forEach(i => i.active = true);
    lastWinnerId = null;
    updateUI();
}
</script>
</body>
</html>
